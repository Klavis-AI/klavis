---
title: "Mastra"
description: "Learn how to build AI agents that integrate Mastra framework with Klavis MCP Servers for enhanced functionality"
---

## Partnership

Mastra has officially featured Klavis AI in [their MCP registry documentation](https://mastra.ai/en/docs/tools-mcp/mcp-overview#connecting-to-an-mcp-registry), showcasing how to connect to MCP servers for building powerful AI agents.

<Frame>
  <img src="/images/ai-platform/mastra-klavis.png" alt="Mastra and Klavis Integration - Connect to MCP servers through registry" />
</Frame>

# Mastra + Klavis AI Integration

This tutorial demonstrates how to use Mastra, an open-source TypeScript framework for building AI agents, with Klavis MCP (Model Context Protocol) servers.

## Prerequisites

Before we begin, you'll need:

<CardGroup cols={2}>
  <Card title="OpenAI API Key" icon="key" href="https://platform.openai.com/api-keys">
    Get your API key from OpenAI Platform
  </Card>
  <Card title="Klavis AI API Key" icon="key" href="https://klavis.ai/">
    Get your API key from Klavis AI
  </Card>
</CardGroup>

## Getting Started

You can find the complete example code in Klavis GitHub repository:

**[üìÅ Checkout the code here](https://github.com/Klavis-AI/klavis/tree/main/examples/mastra)**

## Setup Environment Variables

Create a `.env` file in your project root:

```env
OPENAI_API_KEY=your_openai_api_key_here
KLAVIS_API_KEY=your_klavis_api_key_here
```

## Project Structure

```
mastra-klavis-example/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ mastra/
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ tsconfig.json
```

## Code Example

```typescript
import { Mastra } from '@mastra/core/mastra';
import { Agent } from '@mastra/core/agent';
import { openai } from '@ai-sdk/openai';
import { MCPClient } from '@mastra/mcp';
import { KlavisClient, Klavis } from 'klavis';
import open from 'open';

/**
 * Creates an MCP Agent with tools from a Klavis Strata server
 * Strata servers support multiple MCP servers (Gmail, Slack, etc.)
 */
export const createStrataMcpAgent = async (userId: string = 'test-user'): Promise<Agent> => {
  const klavis = new KlavisClient({ apiKey: process.env.KLAVIS_API_KEY! });

  // Create a Strata server with Gmail and Slack
  const response = await klavis.mcpServer.createStrataServer({
    servers: [Klavis.McpServerName.Gmail, Klavis.McpServerName.Slack],
    userId
  });

  // Handle OAuth authorization for each service
  if (response.oauthUrls) {
    for (const [serverName, oauthUrl] of Object.entries(response.oauthUrls)) {
      open(oauthUrl);
      console.log(`Please complete ${serverName} OAuth authorization at: ${oauthUrl}`);
    }
  }

  // Initialize the MCP client with Strata server URL
  const mcpClient = new MCPClient({
    servers: {
      strata: {
        url: new URL(response.strataServerUrl)
      }
    }
  });

  // Get tools from the Strata server
  const tools = await mcpClient.getTools();

  // Create agent
  return new Agent({
    name: 'Strata MCP Agent',
    instructions: `You are an AI agent with access to Gmail and Slack tools. You can read, send, search emails, manage labels, send Slack messages, and more.`,
    model: openai('gpt-4o-mini'),
    tools
  });
};

const agent = await createStrataMcpAgent();

export const mastra = new Mastra({
  agents: { agent }
});
```

## Running the Agent

```bash
npm install
npm run dev
```

## Video Tutorial

<iframe
  style={{
    width: '100%',
    aspectRatio: '16/9',
    border: 'none'
  }}
  src="https://www.youtube.com/embed/PkOVdIYD3u8"
  title="Mastra + Klavis AI Integration Tutorial"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowfullscreen
></iframe>

## Summary

This implementation demonstrates how to integrate Mastra with Klavis Strata servers to access multiple MCP services (Gmail and Slack) through a single unified server. The agent can handle Gmail operations like reading, sending, searching emails, managing labels, as well as Slack operations like sending messages and more through the MCP protocol.

## Useful Resources

- [Mastra Doc](https://mastra.ai/docs)
- [Mastra GitHub Repo](https://github.com/mastra-ai/mastra)
- [MCP Spec](https://modelcontextprotocol.io/)

**Happy building with Mastra and Klavis!** üöÄ 